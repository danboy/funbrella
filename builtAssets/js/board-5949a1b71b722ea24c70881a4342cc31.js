function messageBoard(a){jade.debug=[{lineno:1,filename:undefined}];try{var b=[],c=a||{},d=c.time,e=c.messages;return jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push('<h1 class="clock">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=d)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</h1>"),jade.debug.shift(),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push('<ul class="message-list">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push(" "),jade.debug.shift(),jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),function(){var a=e;if("number"==typeof a.length)for(var c=0,d=a.length;c<d;c++){var f=a[c];jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:5,filename:jade.debug[0].filename}),b.push("<li"+jade.attrs({"class":[""+f.type+""]},{"class":!0})+">"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:6,filename:jade.debug[0].filename}),f.sender&&(jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push("<strong>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=f.sender)==null?"":jade.interp)+":"),jade.debug.shift(),jade.debug.shift(),b.push("</strong>"),jade.debug.shift(),jade.debug.shift()),jade.debug.shift(),jade.debug.unshift({lineno:8,filename:jade.debug[0].filename}),b.push(""+((jade.interp=f.content)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</li>"),jade.debug.shift(),jade.debug.shift()}else{var d=0;for(var c in a){d++;var f=a[c];jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:5,filename:jade.debug[0].filename}),b.push("<li"+jade.attrs({"class":[""+f.type+""]},{"class":!0})+">"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:6,filename:jade.debug[0].filename}),f.sender&&(jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push("<strong>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=f.sender)==null?"":jade.interp)+":"),jade.debug.shift(),jade.debug.shift(),b.push("</strong>"),jade.debug.shift(),jade.debug.shift()),jade.debug.shift(),jade.debug.unshift({lineno:8,filename:jade.debug[0].filename}),b.push(""+((jade.interp=f.content)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</li>"),jade.debug.shift(),jade.debug.shift()}}}.call(this),jade.debug.shift(),jade.debug.shift(),b.push("</ul>"),jade.debug.shift(),jade.debug.shift(),b.join("")}catch(f){jade.rethrow(f,jade.debug[0].filename,jade.debug[0].lineno)}}function messageTemplate(a){jade.debug=[{lineno:1,filename:undefined}];try{var b=[];return jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),b.push('<div id="message">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push('<div class="form pure-form pure-form-stacked">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push('<textarea placeholder="send a message.">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.shift(),b.push("</textarea>"),jade.debug.shift(),jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),b.push('<label for="sticky">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),b.push("Stick for"),jade.debug.shift(),jade.debug.shift(),b.push("</label>"),jade.debug.shift(),jade.debug.unshift({lineno:5,filename:jade.debug[0].filename}),b.push('<input name="sticky" value="0"/>'),jade.debug.shift(),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push("<br/>"),jade.debug.shift(),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push('<a class="pure-button send">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push("Send a message."),jade.debug.shift(),jade.debug.shift(),b.push("</a>"),jade.debug.shift(),jade.debug.shift(),b.push("</div>"),jade.debug.shift(),jade.debug.shift(),b.push("</div>"),jade.debug.shift(),jade.debug.shift(),b.join("")}catch(c){jade.rethrow(c,jade.debug[0].filename,jade.debug[0].lineno)}}function prefs(a){jade.debug=[{lineno:1,filename:undefined}];try{var b=[],c=a||{},d=c.help,e=c._csrf,f=c.model,g=c.prefs;return jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),b.push('<div class="widget-prefs">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push("<h1>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=d.title)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</h1>"),jade.debug.shift(),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push("<p>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push(" "),jade.debug.shift(),b.push("\n"),jade.debug.unshift({lineno:4,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=d.description)==null?"":jade.interp)+"&nbsp;"),jade.debug.shift(),jade.debug.unshift({lineno:5,filename:jade.debug[0].filename}),b.push("<a"+jade.attrs({href:""+d.link.url+"",target:"_new"},{href:!0,target:!0})+">"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:5,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=d.link.text)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</a>"),jade.debug.shift(),jade.debug.shift(),b.push("</p>"),jade.debug.shift(),jade.debug.unshift({lineno:6,filename:jade.debug[0].filename}),b.push('<form action="/widgets/update-prefs" method="POST" class="pure-form pure-form-stacked">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:7,filename:jade.debug[0].filename}),b.push("<input"+jade.attrs({type:"hidden",name:"_csrf",value:""+e+""},{type:!0,name:!0,value:!0})+"/>"),jade.debug.shift(),jade.debug.unshift({lineno:8,filename:jade.debug[0].filename}),b.push("<input"+jade.attrs({type:"hidden",name:"_id",value:""+f._id+""},{type:!0,name:!0,value:!0})+"/>"),jade.debug.shift(),jade.debug.unshift({lineno:9,filename:jade.debug[0].filename}),function(){var a=g;if("number"==typeof a.length)for(var c=0,d=a.length;c<d;c++){var e=a[c];jade.debug.unshift({lineno:9,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:10,filename:jade.debug[0].filename}),b.push("<input"+jade.attrs({type:"text",name:""+e.name+"",placeholder:""+e.name+"",value:""+e.value+"","data-type":""+e.type+"","class":["pref"]},{type:!0,name:!0,placeholder:!0,value:!0,"data-type":!0,"class":!0})+"/>"),jade.debug.shift(),jade.debug.shift()}else{var d=0;for(var c in a){d++;var e=a[c];jade.debug.unshift({lineno:9,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:10,filename:jade.debug[0].filename}),b.push("<input"+jade.attrs({type:"text",name:""+e.name+"",placeholder:""+e.name+"",value:""+e.value+"","data-type":""+e.type+"","class":["pref"]},{type:!0,name:!0,placeholder:!0,value:!0,"data-type":!0,"class":!0})+"/>"),jade.debug.shift(),jade.debug.shift()}}}.call(this),jade.debug.shift(),jade.debug.unshift({lineno:11,filename:jade.debug[0].filename}),b.push('<input type="submit" value="configure" class="pure-button prefs-submit"/>'),jade.debug.shift(),jade.debug.shift(),b.push("</form>"),jade.debug.shift(),jade.debug.shift(),b.push("</div>"),jade.debug.shift(),jade.debug.shift(),b.join("")}catch(h){jade.rethrow(h,jade.debug[0].filename,jade.debug[0].lineno)}}function watcher(a){jade.debug=[{lineno:1,filename:undefined}];try{var b=[],c=a||{},d=c.title,e=c.body;return jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:1,filename:jade.debug[0].filename}),b.push('<div class="message">'),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push("<h1>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:2,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=d)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</h1>"),jade.debug.shift(),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push("<p>"),jade.debug.unshift({lineno:undefined,filename:jade.debug[0].filename}),jade.debug.unshift({lineno:3,filename:jade.debug[0].filename}),b.push(""+jade.escape((jade.interp=e)==null?"":jade.interp)+""),jade.debug.shift(),jade.debug.shift(),b.push("</p>"),jade.debug.shift(),jade.debug.shift(),b.push("</div>"),jade.debug.shift(),jade.debug.shift(),b.join("")}catch(f){jade.rethrow(f,jade.debug[0].filename,jade.debug[0].lineno)}}(function(a){if("function"==typeof bootstrap)bootstrap("jade",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeJade=a}else"undefined"!=typeof window?window.jade=a():global.jade=a()})(function(){var a,b,c,d,e;return function f(a,b,c){function d(g,h){if(!b[g]){if(!a[g]){var j=typeof require=="function"&&require;if(!h&&j)return j(g,!0);if(e)return e(g,!0);throw new Error("Cannot find module '"+g+"'")}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return d(c?c:b)},k,k.exports,f,a,b,c)}return b[g].exports}var e=typeof require=="function"&&require;for(var g=0;g<c.length;g++)d(c[g]);return d}({1:[function(a,b,c){function d(a){return a!=null&&a!==""}function e(a){return Array.isArray(a)?a.map(e).filter(d).join(" "):a}Array.isArray||(Array.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)}),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),c.merge=function f(a,b){var c=a["class"],e=b["class"];if(c||e)c=c||[],e=e||[],Array.isArray(c)||(c=[c]),Array.isArray(e)||(e=[e]),a["class"]=c.concat(e).filter(d);for(var f in b)f!="class"&&(a[f]=b[f]);return a},c.attrs=function g(a,b){var d=[],f=a.terse;delete a.terse;var g=Object.keys(a),h=g.length;if(h){d.push("");for(var i=0;i<h;++i){var j=g[i],k=a[j];"boolean"==typeof k||null==k?k&&(f?d.push(j):d.push(j+'="'+j+'"')):0==j.indexOf("data")&&"string"!=typeof k?d.push(j+"='"+JSON.stringify(k)+"'"):"class"==j?b&&b[j]?(k=c.escape(e(k)))&&d.push(j+'="'+k+'"'):(k=e(k))&&d.push(j+'="'+k+'"'):b&&b[j]?d.push(j+'="'+c.escape(k)+'"'):d.push(j+'="'+k+'"')}}return d.join(" ")},c.escape=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},c.rethrow=function i(b,c,d,e){if(b instanceof Error){if((typeof window!="undefined"||!c)&&!e)throw b.message+=" on line "+d,b;try{e=e||a("fs").readFileSync(c,"utf8")}catch(f){i(b,null,d)}var g=3,h=e.split("\n"),j=Math.max(d-g,0),k=Math.min(h.length,d+g),g=h.slice(j,k).map(function(a,b){var c=b+j+1;return(c==d?"  > ":"    ")+c+"| "+a}).join("\n");throw b.path=c,b.message=(c||"Jade")+":"+d+"\n"+g+"\n\n"+b.message,b}throw b}},{fs:2}],2:[function(a,b,c){},{}]},{},[1])(1)});var Socket=function(a,b){this.socketpath=a,this.socket=new SockJS(a),this.send=b,this.open(this.socket,this.send)};Socket.prototype={open:function(a,b){self=this,a.onmessage=function(a){self.routeMessage(JSON.parse(a.data))},a.onclose=function(a){console.log("SOCK CLOSED",self.socketpath,a),setTimeout(function(){self.socket=new SockJS(self.socketpath),window.socket=self.socket,self.open(self.socket,self.send)},5e3)}},routeMessage:function(a){a.type?self[a.type](a):this.send(a)},message:function(a){this.send(a)},popup:function(a){window.open(a.url,"popup","fullscreen=yes,width=1600,height=900")}};var Funbrella=Funbrella||{};Funbrella.Widget=Backbone.Model.extend({url:"/widgets"}),Funbrella.Widgets=Backbone.Collection.extend({model:Funbrella.Widget});var Funbrella=Funbrella||{};Funbrella.SettingsView=Backbone.View.extend({initialize:function(a){this.model=new Funbrella.Widget(a.model),this.prefs=$.extend(this.prefs,a.model.prefs),this.hasRequiredPrefs()&&!a.stopped?(this.setup(),this.start(),this.addClass()):this.configure()},addClass:function(){this.$el.addClass(this.model.get("type"))},events:{"click .prefs-submit":"updatePrefs"},setup:function(){return!0},prefs:{frequency:60},help:{title:"I need some settings",description:"I need some settings to work, check the documentation for",link:{url:"http://github.com/danboy/funbrella",text:"more info"}},config:{xml:!1,fetch:!0},requires:[],hasRequiredPrefs:function(){var a=!0;return this.requires.forEach(function(b){if(this.prefs[b]==undefined||this.prefs[b]=="")a=!1}.bind(this)),a},configure:function(){this.$el.removeClass(this.model.get("type")),this.$el.html(this.prefsTemplate({prefs:this.getPrefs(),_csrf:window._csrf,model:this.model.toJSON(),help:this.help}))},typeofPref:{object:function(a){return a.val().split(",")},"boolean":function(a){return a.val()=="true"?!0:!1},string:function(a){return a.val()},number:function(a){return parseInt(a.val())}},prefsTemplate:prefs,random:function(a){return position=Math.floor(Math.random()*a.length),a[position]},updatePrefs:function(a){a.stopPropagation(),a.preventDefault(),this.$el.find("input.pref").each(function(a,b){var b=$(b);this.prefs[$(b).attr("name")]=this.typeofPref[b.data("type")](b)}.bind(this));var b=this.prefs,c=this.$el.find("input[name=_id]")[0].value,d=this;$.ajax({type:"POST",url:"/widgets/update-prefs",data:{_csrf:_csrf,prefs:b,_id:c},success:function(a,b){document.location.reload()}})},getPrefs:function(){var a=[];for(var b in this.prefs)a.push({name:b,value:this.prefs[b],type:typeof this.prefs[b]});return a}}),Funbrella.PrefsView=function(a){if(a.type=="watcher")var b=new Funbrella.Watch[a.model.type]({el:"#prefs-form",model:a.model,stopped:!0});else var b=new Funbrella[a.model.type]({el:"#prefs-form",model:a.model,stopped:!0});b.stop(),b.$el.removeClass(a.model.type),b.fetchData=!1,b.configure()},Funbrella.WidgetView=Funbrella.SettingsView.extend({retrieveData:function(){this.fetchData==!1?this.data('{"data": "no widget."}',function(a){this.render(a)}.bind(this)):this.fetch()},start:function(){this.retrieveData(),this.timer=setInterval(function(){this.retrieveData()}.bind(this),this.prefs.frequency*1e3)},stop:function(){clearInterval(this.timer),this.timer=!1},fetch:function(){var a=this;$.ajax(document.location.origin+"/fetch",{type:"POST",data:{url:a.url,xml:a.config.xml,_csrf:window._csrf,Authorization:a.headers},success:function(b){if(typeof b=="string")try{a.data(JSON.parse(b),function(b){a.render(b)})}catch(c){console.log("ERROR",c,"response",JSON.parse(b),"type",typeof b),a.configure()}else a.data(b,function(b){a.render(b)})},error:function(b){console.log("WIDGET.js ERROR",a.url,b)}})},data:function(a,b){typeof a=="string"?b(JSON.parse(a)):b(a)},render:function(a){this.$el.html(this.template(a))}});var Funbrella=Funbrella||{};Funbrella.messageBoard=Funbrella.WidgetView.extend({prefs:{frequency:1},template:messageBoard,send:function(a){var b=a.stickFor||0;a.timestamp=this.stickyFor(new Date,b);var c=this.collection.push(a)},setup:function(){this.fetchData=!1,this.collection=new Funbrella.Widgets,this.collection.comparator=function(a){return-a.get("timestamp").getTime()},this.addMessageForm()},data:function(a,b){this.collection.sort(),b({time:this.getTime(),messages:this.collection.toJSON()})},stickyFor:function(a,b){return new Date(a.getTime()+b*6e4)},getTime:function(a){var a=a||new Date,b=new Date(a),c=b.getHours(),d=b.getMinutes();c>12&&(c=c-12),String.prototype.fatten=function(){return this<10?"0"+this:this};var a=c.toString().fatten()+":"+d.toString().fatten();return this.prefs.showSeconds&&(a=a+b.getSeconds().toString().fatten()),a},messageTemplate:messageTemplate,addMessageForm:function(){$("body").append(this.messageTemplate()),$("#message .send").click(function(){sock.socket.send(JSON.stringify({content:$("#message textarea").val(),stickFor:$("#message input[name=sticky]").val()})),$("#message textarea").val("")})}}),Funbrella.Watcher=Funbrella.WidgetView.extend({template:watcher,render:function(a){Funbrella.Messages.send(a)},addClass:function(){return!0}}),Hogan={compile:function(){}}